version: "3.8"

networks:
  kong-net:

services:
  kong:
    image: kong:3.8
    container_name: kong-api-gateway-kong
    restart: unless-stopped
    networks:
      - kong-net
    ports:
      - "8000:8000"   # Public proxy
      - "8443:8443"   # HTTPS proxy
      - "8001:8001"   # Admin API
      - "8444:8444"   # Admin HTTPS
    environment:
      KONG_DATABASE: "off"   # DB-less mode
      KONG_DECLARATIVE_CONFIG: /etc/kong/kong.yaml
      KONG_PROXY_ACCESS_LOG: /dev/stdout
      KONG_ADMIN_ACCESS_LOG: /dev/stdout
      KONG_PROXY_ERROR_LOG: /dev/stderr
      KONG_ADMIN_ERROR_LOG: /dev/stderr
    volumes:
      - ./kong.yaml:/etc/kong/kong.yaml

  konga:
    image: pantsel/konga:latest
    container_name: kong-api-gateway-konga
    restart: unless-stopped
    networks:
      - kong-net
    ports:
      - "1337:1337"
    environment:
      NODE_ENV: development
    depends_on:
      - kong





# # 1Ô∏è‚É£ Start Kong + Konga
# docker compose -f infra/kong-API-gateway/docker-compose-kong.yaml up -d

# # 2Ô∏è‚É£ Stop Kong + Konga
# docker compose -f infra/kong-API-gateway/docker-compose-kong.yaml down

# # 3Ô∏è‚É£ Rebuild + restart Kong + Konga
# docker compose -f infra/kong-API-gateway/docker-compose-kong.yaml up -d --build

# # 4Ô∏è‚É£ Reload declarative configuration (DB-less) using the Admin API
# curl -i -X POST http://localhost:8001/config \
#   -H "Content-Type: application/yaml" \
#   --data-binary "@infra/kong-API-gateway/kong.yaml"

# # 5Ô∏è‚É£ Check running Kong/Konga containers
# docker ps

# # 6Ô∏è‚É£ View Kong logs
# docker logs -f kong-api-gateway-kong

# # 7Ô∏è‚É£ View Konga logs
# docker logs -f kong-api-gateway-konga

# # 8Ô∏è‚É£ Test Kong proxy is running
# curl -i http://localhost:8000/

# # 9Ô∏è‚É£ Verify Kong Admin API
# curl -i http://localhost:8001/

# # üîü Test a microservice through Kong route (example: user-service)
# curl -i http://localhost:8000/api/user